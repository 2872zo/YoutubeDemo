package com.example.demo;

import java.util.Map;

import com.fasterxml.jackson.core.JsonParser;
import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.DeserializationFeature;
import com.fasterxml.jackson.databind.ObjectMapper;

public class YoutubeDaoImpl {
	
	private final String youtubeAPI = "AIzaSyAnRsFVJgnbKy0IMb8CAo-4seoXBl1lExY";
	
	public YoutubeResponse searchVideo(Search search) throws Exception {
		HttpConnection httpConnection = new HttpConnection();
		
		String targetUrl = "https://www.googleapis.com/youtube/v3/search?key=" + youtubeAPI + "&part=snippet&type=video&maxResults=20&q=" + search.getKeyword();
		String searchResult = httpConnection.sendGet(targetUrl);
		
		//api키 절약용 keyword=doom 결과 5개
//		String searchResult = "{ \"kind\": \"youtube#searchListResponse\", \"etag\": \"\\\"Bdx4f4ps3xCOOo1WZ91nTLkRZ_c/yAlKordED0hW9aJL8OH4NHlGvy8\\\"\", \"nextPageToken\": \"CAUQAA\", \"regionCode\": \"KR\", \"pageInfo\": {  \"totalResults\": 1000000,  \"resultsPerPage\": 5 }, \"items\": [  {   \"kind\": \"youtube#searchResult\",   \"etag\": \"\\\"Bdx4f4ps3xCOOo1WZ91nTLkRZ_c/tlGvyGanhq4w4WsvHb7Th9lL6P8\\\"\",   \"id\": {    \"kind\": \"youtube#video\",    \"videoId\": \"dS-ti6XjT4A\"   },   \"snippet\": {    \"publishedAt\": \"2019-06-10T01:39:45.000Z\",    \"channelId\": \"UCUnRn1f78foyP26XGkRfWsA\",    \"title\": \"DOOM Eternal – Official Story Trailer | E3 2019\",    \"description\": \"Raze Hell. DOOM Eternal launches on 11.22.19. Watch the all-new Story Trailer for DOOM Eternal, the much-anticipated sequel to DOOM (2016). DOOM Eternal ...\",    \"thumbnails\": {     \"default\": {      \"url\": \"https://i.ytimg.com/vi/dS-ti6XjT4A/default.jpg\",      \"width\": 120,      \"height\": 90     },     \"medium\": {      \"url\": \"https://i.ytimg.com/vi/dS-ti6XjT4A/mqdefault.jpg\",      \"width\": 320,      \"height\": 180     },     \"high\": {      \"url\": \"https://i.ytimg.com/vi/dS-ti6XjT4A/hqdefault.jpg\",      \"width\": 480,      \"height\": 360     }    },    \"channelTitle\": \"GameSpot Trailers\",    \"liveBroadcastContent\": \"none\"   }  },  {   \"kind\": \"youtube#searchResult\",   \"etag\": \"\\\"Bdx4f4ps3xCOOo1WZ91nTLkRZ_c/ahQH7AFbY89yXcQCs0-jd2JOsbA\\\"\",   \"id\": {    \"kind\": \"youtube#video\",    \"videoId\": \"eqbmlCxECQY\"   },   \"snippet\": {    \"publishedAt\": \"2019-06-10T01:54:25.000Z\",    \"channelId\": \"UCVS9tA3PI8Gard_LrTx0YsQ\",    \"title\": \"Doom Eternal Gameplay | E3 2019\",    \"description\": \"Gameplay from Doom Eternal, from Bethesda's E3 2019 press conference. For more videos, news, previews and reviews, go to http://kotaku.com.\",    \"thumbnails\": {     \"default\": {      \"url\": \"https://i.ytimg.com/vi/eqbmlCxECQY/default.jpg\",      \"width\": 120,      \"height\": 90     },     \"medium\": {      \"url\": \"https://i.ytimg.com/vi/eqbmlCxECQY/mqdefault.jpg\",      \"width\": 320,      \"height\": 180     },     \"high\": {      \"url\": \"https://i.ytimg.com/vi/eqbmlCxECQY/hqdefault.jpg\",      \"width\": 480,      \"height\": 360     }    },    \"channelTitle\": \"Kotaku\",    \"liveBroadcastContent\": \"none\"   }  },  {   \"kind\": \"youtube#searchResult\",   \"etag\": \"\\\"Bdx4f4ps3xCOOo1WZ91nTLkRZ_c/KllEs0A7tY0-JN1aiCRnXDOdIfA\\\"\",   \"id\": {    \"kind\": \"youtube#video\",    \"videoId\": \"CGq8Ee2gOe4\"   },   \"snippet\": {    \"publishedAt\": \"2018-08-10T22:07:35.000Z\",    \"channelId\": \"UCvZHe-SP3xC7DdOk4Ri8QBw\",    \"title\": \"DOOM Eternal – Official Gameplay Reveal\",    \"description\": \"Watch the exclusive reveal of DOOM Eternal, featuring over 15 minutes of gameplay. The DOOM Slayer returns in DOOM Eternal, the much-anticipated sequel to ...\",    \"thumbnails\": {     \"default\": {      \"url\": \"https://i.ytimg.com/vi/CGq8Ee2gOe4/default.jpg\",      \"width\": 120,      \"height\": 90     },     \"medium\": {      \"url\": \"https://i.ytimg.com/vi/CGq8Ee2gOe4/mqdefault.jpg\",      \"width\": 320,      \"height\": 180     },     \"high\": {      \"url\": \"https://i.ytimg.com/vi/CGq8Ee2gOe4/hqdefault.jpg\",      \"width\": 480,      \"height\": 360     }    },    \"channelTitle\": \"Bethesda Softworks\",    \"liveBroadcastContent\": \"none\"   }  },  {   \"kind\": \"youtube#searchResult\",   \"etag\": \"\\\"Bdx4f4ps3xCOOo1WZ91nTLkRZ_c/uOM5dksKf6JN2uMT5uzUbP4rUgk\\\"\",   \"id\": {    \"kind\": \"youtube#video\",    \"videoId\": \"uz7YK7tx-D8\"   },   \"snippet\": {    \"publishedAt\": \"2009-07-26T09:31:20.000Z\",    \"channelId\": \"UCWnX7jdDzy0qMqRSPgFzwYw\",    \"title\": \"dhoom again full song HQ ...\",    \"description\": \"\",    \"thumbnails\": {     \"default\": {      \"url\": \"https://i.ytimg.com/vi/uz7YK7tx-D8/default.jpg\",      \"width\": 120,      \"height\": 90     },     \"medium\": {      \"url\": \"https://i.ytimg.com/vi/uz7YK7tx-D8/mqdefault.jpg\",      \"width\": 320,      \"height\": 180     },     \"high\": {      \"url\": \"https://i.ytimg.com/vi/uz7YK7tx-D8/hqdefault.jpg\",      \"width\": 480,      \"height\": 360     }    },    \"channelTitle\": \"latinapower91\",    \"liveBroadcastContent\": \"none\"   }  },  {   \"kind\": \"youtube#searchResult\",   \"etag\": \"\\\"Bdx4f4ps3xCOOo1WZ91nTLkRZ_c/ZSnno2tHxCI2g7ZrMgZgoHQfaDA\\\"\",   \"id\": {    \"kind\": \"youtube#video\",    \"videoId\": \"cQYSf7r_HpA\"   },   \"snippet\": {    \"publishedAt\": \"2019-06-27T00:34:11.000Z\",    \"channelId\": \"UCrDg4SA_YyX4kUqh6W3IWjA\",    \"title\": \"DOOM ETERNAL - ALL WEAPONS AND MONSTERS (SO FAR)\",    \"description\": \"\",    \"thumbnails\": {     \"default\": {      \"url\": \"https://i.ytimg.com/vi/cQYSf7r_HpA/default.jpg\",      \"width\": 120,      \"height\": 90     },     \"medium\": {      \"url\": \"https://i.ytimg.com/vi/cQYSf7r_HpA/mqdefault.jpg\",      \"width\": 320,      \"height\": 180     },     \"high\": {      \"url\": \"https://i.ytimg.com/vi/cQYSf7r_HpA/hqdefault.jpg\",      \"width\": 480,      \"height\": 360     }    },    \"channelTitle\": \"LeonardoETC\",    \"liveBroadcastContent\": \"none\"   }  } ]}";
//		String searchResult = "{ \"kind\": \"youtube#searchListResponse\", \"etag\": \"\\\"Bdx4f4ps3xCOOo1WZ91nTLkRZ_c/rDyUt9CMouQ-NJmOPO2vwmVbd3I\\\"\", \"nextPageToken\": \"CAUQAA\", \"regionCode\": \"KR\", \"pageInfo\": {  \"totalResults\": 1000000,  \"resultsPerPage\": 5 }, \"items\": [  {   \"kind\": \"youtube#searchResult\",   \"etag\": \"\\\"Bdx4f4ps3xCOOo1WZ91nTLkRZ_c/q98Vr3XvNAc4Kx09so0A_Mgg2oI\\\"\",   \"id\": {    \"kind\": \"youtube#video\",    \"videoId\": \"WJXJdyMs6cg\"   },   \"snippet\": {    \"publishedAt\": \"2019-07-06T18:15:53.000Z\",    \"channelId\": \"UCfAPTv1LgeEWevG8X_6PUOQ\",    \"title\": \"Fishing for the Fairy Bottle in Zelda: Link&#39;s Awakening (Switch - DIRECT FEED)\",    \"description\": \"It's time to go fishing in Mabe Village but there's something new to catch, a Fairy Bottle! See the minigame in action in this new direct feed footage from The ...\",    \"thumbnails\": {     \"default\": {      \"url\": \"https://i.ytimg.com/vi/WJXJdyMs6cg/default.jpg\",      \"width\": 120,      \"height\": 90     },     \"medium\": {      \"url\": \"https://i.ytimg.com/vi/WJXJdyMs6cg/mqdefault.jpg\",      \"width\": 320,      \"height\": 180     },     \"high\": {      \"url\": \"https://i.ytimg.com/vi/WJXJdyMs6cg/hqdefault.jpg\",      \"width\": 480,      \"height\": 360     }    },    \"channelTitle\": \"GameXplain\",    \"liveBroadcastContent\": \"none\"   }  },  {   \"kind\": \"youtube#searchResult\",   \"etag\": \"\\\"Bdx4f4ps3xCOOo1WZ91nTLkRZ_c/bLRCqYoC_SfR9fFZODPGmmP_3w0\\\"\",   \"id\": {    \"kind\": \"youtube#video\",    \"videoId\": \"njSmZbAQeLk\"   },   \"snippet\": {    \"publishedAt\": \"2019-07-06T14:26:56.000Z\",    \"channelId\": \"UCZU03wNQEGmDkGcNN-BT2Ng\",    \"title\": \"Super Mario Maker 2 - Zelda BotW Great Plateau Level\",    \"description\": \"Super Mario Maker 2 - The Great Plateau (BOTW) by Reshiram52. ▻Level ID: 45B-C0S-LNG ▻SUPER MARIO MAKER 2 - STORY MODE PLAYLIST: ...\",    \"thumbnails\": {     \"default\": {      \"url\": \"https://i.ytimg.com/vi/njSmZbAQeLk/default.jpg\",      \"width\": 120,      \"height\": 90     },     \"medium\": {      \"url\": \"https://i.ytimg.com/vi/njSmZbAQeLk/mqdefault.jpg\",      \"width\": 320,      \"height\": 180     },     \"high\": {      \"url\": \"https://i.ytimg.com/vi/njSmZbAQeLk/hqdefault.jpg\",      \"width\": 480,      \"height\": 360     }    },    \"channelTitle\": \"BeardBear\",    \"liveBroadcastContent\": \"none\"   }  },  {   \"kind\": \"youtube#searchResult\",   \"etag\": \"\\\"Bdx4f4ps3xCOOo1WZ91nTLkRZ_c/IeY6G7VT_fYyZmlklqlg_GnuQBs\\\"\",   \"id\": {    \"kind\": \"youtube#channel\",    \"channelId\": \"UC-ol6cvdiLjBn4FrGgvhdrA\"   },   \"snippet\": {    \"publishedAt\": \"2009-12-15T17:44:43.000Z\",    \"channelId\": \"UC-ol6cvdiLjBn4FrGgvhdrA\",    \"title\": \"ZeldaMaster\",    \"description\": \"I play games and discuss them! From Let's Plays, theories, discussions, guides, countdowns and other gaming related video content. Especially when it comes ...\",    \"thumbnails\": {     \"default\": {      \"url\": \"https://yt3.ggpht.com/-EOVIMhudkbY/AAAAAAAAAAI/AAAAAAAAAAA/o7zldVHVN08/s88-c-k-no-mo-rj-c0xffffff/photo.jpg\"     },     \"medium\": {      \"url\": \"https://yt3.ggpht.com/-EOVIMhudkbY/AAAAAAAAAAI/AAAAAAAAAAA/o7zldVHVN08/s240-c-k-no-mo-rj-c0xffffff/photo.jpg\"     },     \"high\": {      \"url\": \"https://yt3.ggpht.com/-EOVIMhudkbY/AAAAAAAAAAI/AAAAAAAAAAA/o7zldVHVN08/s800-c-k-no-mo-rj-c0xffffff/photo.jpg\"     }    },    \"channelTitle\": \"ZeldaMaster\",    \"liveBroadcastContent\": \"upcoming\"   }  },  {   \"kind\": \"youtube#searchResult\",   \"etag\": \"\\\"Bdx4f4ps3xCOOo1WZ91nTLkRZ_c/ut45NLpVyeJE8LVeOAkSEDV1u6c\\\"\",   \"id\": {    \"kind\": \"youtube#video\",    \"videoId\": \"dqATYp6v3DY\"   },   \"snippet\": {    \"publishedAt\": \"2019-07-06T23:30:02.000Z\",    \"channelId\": \"UCLGYDvut8xexcpMGQMwjt0w\",    \"title\": \"Zelda: Ocarina of Time Skullsanity Randomizer - Part 1 (ZOOTR 3)\",    \"description\": \"What happens when you mix in all 100 Skulltula Token into the randomizer?? Here's your answer. What's new this time? We're adding in skullsanity, shopsanity, ...\",    \"thumbnails\": {     \"default\": {      \"url\": \"https://i.ytimg.com/vi/dqATYp6v3DY/default.jpg\",      \"width\": 120,      \"height\": 90     },     \"medium\": {      \"url\": \"https://i.ytimg.com/vi/dqATYp6v3DY/mqdefault.jpg\",      \"width\": 320,      \"height\": 180     },     \"high\": {      \"url\": \"https://i.ytimg.com/vi/dqATYp6v3DY/hqdefault.jpg\",      \"width\": 480,      \"height\": 360     }    },    \"channelTitle\": \"AttackingTucans\",    \"liveBroadcastContent\": \"none\"   }  },  {   \"kind\": \"youtube#searchResult\",   \"etag\": \"\\\"Bdx4f4ps3xCOOo1WZ91nTLkRZ_c/uruFZnnS8o2qXdRL2JJaHVCUDe0\\\"\",   \"id\": {    \"kind\": \"youtube#video\",    \"videoId\": \"NNcy-C91sB0\"   },   \"snippet\": {    \"publishedAt\": \"2019-07-05T16:00:04.000Z\",    \"channelId\": \"UCl7ZXbZUCWI2Hz--OrO4bsA\",    \"title\": \"Outset Island from Wind Waker Found in Zelda: Breath of the Wild | Nintendo Switch\",    \"description\": \"We can't believe we didn't see it before. Full credit for this discovery to Jon Cartwright from GameXplain. Check out our full site: http://www.nintendolife.com Like ...\",    \"thumbnails\": {     \"default\": {      \"url\": \"https://i.ytimg.com/vi/NNcy-C91sB0/default.jpg\",      \"width\": 120,      \"height\": 90     },     \"medium\": {      \"url\": \"https://i.ytimg.com/vi/NNcy-C91sB0/mqdefault.jpg\",      \"width\": 320,      \"height\": 180     },     \"high\": {      \"url\": \"https://i.ytimg.com/vi/NNcy-C91sB0/hqdefault.jpg\",      \"width\": 480,      \"height\": 360     }    },    \"channelTitle\": \"Nintendo Life\",    \"liveBroadcastContent\": \"none\"   }  } ]}";
		
		

		
		System.out.println("SearchResult : " + searchResult);
		
		ObjectMapper objectMapper = new ObjectMapper();
		
		//unrecognized 해결
		objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
		
		YoutubeResponse youtubeResponse = objectMapper.readValue(searchResult, YoutubeResponse.class);
		
		//dubug용
//		System.out.println(youtubeResponse);
		
		return youtubeResponse;
	}
}
